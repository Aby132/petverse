# AWS Cognito Setup Scripts

This directory contains automated scripts to set up and manage AWS Cognito authentication for the PetVerse application.

## Prerequisites

### 1. AWS CLI Installation
**Windows:**
```powershell
# Using Chocolatey
choco install awscli

# Or download from: https://aws.amazon.com/cli/
```

**macOS:**
```bash
# Using Homebrew
brew install awscli

# Or using pip
pip install awscli
```

**Linux:**
```bash
# Using pip
pip install awscli

# Or using package manager
sudo apt-get install awscli  # Ubuntu/Debian
sudo yum install awscli      # CentOS/RHEL
```

### 2. AWS CLI Configuration
```bash
aws configure
```
You'll need:
- AWS Access Key ID
- AWS Secret Access Key
- Default region (e.g., `us-east-1`)
- Default output format (e.g., `json`)

### 3. Required Permissions
Your AWS user needs the following permissions:
- `cognito-idp:*` (Cognito User Pools)
- `cognito-identity:*` (Cognito Identity Pools)
- `iam:CreateRole`
- `iam:DeleteRole`
- `iam:GetRole`

## Scripts Overview

### ðŸš€ Setup Scripts

#### `setup-cognito.sh` (Linux/macOS)
```bash
chmod +x scripts/setup-cognito.sh
./scripts/setup-cognito.sh
```

#### `setup-cognito.ps1` (Windows PowerShell)
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.\scripts\setup-cognito.ps1
```

**What it creates:**
- âœ… Cognito User Pool with custom `role` attribute
- âœ… User Pool Client (web app)
- âœ… Identity Pool for AWS service access
- âœ… IAM roles for authenticated/unauthenticated users
- âœ… Admin test user (`admin@petverse.com` / `Admin123!`)
- âœ… Configuration file (`cognito-config.json`)

### ðŸ”§ Configuration Scripts

#### `update-config.js`
```bash
node scripts/update-config.js
```

**What it does:**
- âœ… Updates `src/aws-config.js` with real AWS credentials
- âœ… Switches `src/App.js` to use real authentication
- âœ… Creates `.env.local` with environment variables
- âœ… Backs up mock authentication context

#### `use-mock-auth.js`
```bash
node scripts/use-mock-auth.js
```

**What it does:**
- âœ… Switches `src/App.js` back to mock authentication
- âœ… Useful for development without AWS costs

### ðŸ§¹ Cleanup Scripts

#### `cleanup-cognito.sh` (Linux/macOS)
```bash
./scripts/cleanup-cognito.sh
```

**What it removes:**
- âœ… User Pool and all users
- âœ… User Pool Client
- âœ… Identity Pool
- âœ… IAM roles
- âœ… Local configuration files
- âœ… Switches back to mock authentication

## Quick Start Guide

### Option 1: Full AWS Setup (Recommended for Production)

1. **Set up AWS Cognito:**
   ```bash
   # Linux/macOS
   ./scripts/setup-cognito.sh
   
   # Windows
   .\scripts\setup-cognito.ps1
   ```

2. **Update app configuration:**
   ```bash
   node scripts/update-config.js
   ```

3. **Restart development server:**
   ```bash
   npm start
   ```

4. **Test with admin credentials:**
   - Email: `admin@petverse.com`
   - Password: `Admin123!`

### Option 2: Mock Authentication (Development)

The app is already configured with mock authentication. Use these test accounts:

**Admin Account:**
- Email: `admin@petverse.com`
- Password: `admin123`

**User Account:**
- Email: `user@petverse.com`
- Password: `user123`

## Configuration Files

### `cognito-config.json`
Generated by setup scripts, contains:
```json
{
  "region": "us-east-1",
  "userPoolId": "us-east-1_XXXXXXXXX",
  "userPoolClientId": "XXXXXXXXXXXXXXXXXXXXXXXXXX",
  "identityPoolId": "us-east-1:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
  "adminUser": {
    "email": "admin@petverse.com",
    "password": "Admin123!",
    "role": "admin"
  }
}
```

### `.env.local`
Environment variables for the React app:
```env
REACT_APP_AWS_REGION=us-east-1
REACT_APP_USER_POOL_ID=us-east-1_XXXXXXXXX
REACT_APP_USER_POOL_CLIENT_ID=XXXXXXXXXXXXXXXXXXXXXXXXXX
REACT_APP_IDENTITY_POOL_ID=us-east-1:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
```

## Troubleshooting

### Common Issues

#### 1. "AWS CLI not configured"
```bash
aws configure
# Enter your AWS credentials
```

#### 2. "Access Denied" errors
- Check your AWS user has the required permissions
- Verify your AWS credentials are correct

#### 3. "User Pool already exists"
- User Pool names must be unique in your AWS account
- Either delete the existing pool or change the name in the script

#### 4. "Role already exists"
- IAM role names must be unique in your AWS account
- Run the cleanup script first: `./scripts/cleanup-cognito.sh`

#### 5. App still using mock authentication
- Run: `node scripts/update-config.js`
- Restart the development server: `npm start`

### Verification Steps

1. **Check AWS Console:**
   - Go to AWS Cognito â†’ User Pools
   - Verify your pool exists with custom attributes

2. **Test Authentication:**
   - Try logging in with admin credentials
   - Verify role-based redirection works

3. **Check Configuration:**
   - Verify `src/aws-config.js` has real credentials
   - Check `src/App.js` imports real AuthContext

## Cost Considerations

### AWS Cognito Pricing (as of 2024)
- **User Pool:** Free for first 50,000 monthly active users
- **Identity Pool:** Free for first 50,000 identities
- **Additional users:** $0.0055 per monthly active user

### Development Tips
- Use mock authentication during development to avoid costs
- Switch to real AWS only when testing authentication flows
- Clean up resources when not needed

## Security Best Practices

1. **Never commit AWS credentials** to version control
2. **Use environment variables** for configuration
3. **Enable MFA** for admin accounts in production
4. **Set up proper IAM policies** with least privilege
5. **Use HTTPS** in production
6. **Monitor CloudWatch logs** for suspicious activity

## Support

For issues with these scripts:
1. Check the troubleshooting section above
2. Verify AWS CLI configuration: `aws sts get-caller-identity`
3. Check AWS CloudTrail logs for detailed error information
4. Review AWS Cognito documentation: https://docs.aws.amazon.com/cognito/

## Script Customization

You can customize the scripts by modifying these variables:

**Bash script (`setup-cognito.sh`):**
```bash
USER_POOL_NAME="petverse-users"
CLIENT_NAME="petverse-web-client"
REGION="us-east-1"
PROJECT_NAME="petverse"
```

**PowerShell script (`setup-cognito.ps1`):**
```powershell
param(
    [string]$Region = "us-east-1",
    [string]$UserPoolName = "petverse-users",
    [string]$ClientName = "petverse-web-client",
    [string]$ProjectName = "petverse"
)
```
